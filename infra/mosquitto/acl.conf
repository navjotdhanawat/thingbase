# Mosquitto ACL (Access Control List) Configuration
# =================================================
# This file controls which users can access which topics.
#
# Patterns:
#   %c = client id
#   %u = username
#
# Access types:
#   read      = subscribe only
#   write     = publish only  
#   readwrite = both subscribe and publish
#   deny      = explicitly deny (checked first)

# =================================================
# API SERVER ACCESS
# =================================================
# The API server needs full access to all IoT topics
# for processing telemetry and sending commands

user iot-api
topic readwrite iot/#

# =================================================
# SIMULATOR ACCESS (Development Only)
# =================================================
# The simulator needs full access for testing
# Remove or restrict in production

user iot-simulator
topic readwrite iot/#

# =================================================
# PER-DEVICE ACCESS (Pattern-Based)
# =================================================
# Devices authenticate with their deviceId as username.
# Each device can only access its own topics.
#
# Topic structure: iot/{tenantId}/devices/{deviceId}/{messageType}
# The %u pattern matches the username (deviceId)

# Devices can publish telemetry to their own topic
pattern write iot/+/devices/%u/telemetry

# Devices can publish acknowledgments to their own topic  
pattern write iot/+/devices/%u/ack

# Devices can publish status (online/offline) to their own topic
pattern write iot/+/devices/%u/status

# Devices can subscribe to commands on their own topic
pattern read iot/+/devices/%u/command

